# OBS向け ポン出しツール要件定義書

## 1. 概要

本ドキュメントは、OBS (Open Broadcaster Software) のブラウザソース機能、および**ローカルネットワーク**を用いて、ライブ配信中に効果音やBGMを簡単に再生する（ポン出しする）ためのWebアプリケーション（以下、本ツール）の要件を定義するものである。
配信PCのOBSブラウザソースから直接利用するだけでなく、**スマートフォンやタブレットなど、ローカルネットワーク上の別端末をリモコンとして操作する**ことも想定している。

## 2. 目的とスコープ

### 2.1. 目的

*   ライブ配信者が、配信画面からフォーカスを外すことなく、直感的な操作で任意の効果音を再生できる環境を提供する。
*   OBSのブラウザソースとして、または**別端末のブラウザからリモコンとして**利用できるようにする。
*   設定（登録した音声ファイルや音量）が永続化され、OBSを再起動しても同じ状態で利用できることを目指す。

### 2.2. スコープ（対象範囲）

*   ローカルの音声ファイルをツールに登録する機能
*   登録した音声を再生・停止する機能
*   音声ごとの音量、および全体の音量を調整する機能
*   上記設定をブラウザのローカルストレージに保存・復元する機能
*   ボタンのレイアウト（グリッド表示）に関する基本的なカスタマイズ機能
*   **ローカルネットワーク経由でのアクセス機能**

### 2.3. スコープ外（対象外）

*   音声ファイルの編集（トリミング、フェードイン・アウトなど）機能
*   ユーザーアカウント管理、クラウドでの設定同期機能
*   凝ったデザインテーマの切り替え機能
*   外部サービス（Twitchのチャンネルポイントなど）との連携機能
*   インターネット経由でのアクセス（ポートフォワーディング等の設定はユーザーの責任範囲とする）

## 3. ターゲットユーザー

*   PCでゲーム配信や雑談配信を行うライブ配信者。
*   OBSの「ブラウザソース」の追加・設定ができる程度の知識を持つユーザー。
*   **スマートフォン等をリモコンとして活用したいユーザー。**

## 4. 機能要件

### 4.1. 音声管理機能

| No. | 機能名 | 機能概要 | 備考 |
| :-- | :--- | :--- | :--- |
| 4.1.1 | フォルダからの自動読み込み | アプリケーションと同じ階層にある特定のフォルダ（例: `sounds`）内の音声ファイルを起動時に自動で読み込み、再生ボタンとして表示する。 | **サーバーが起動する際にファイル一覧が生成される。** |
| 4.1.2 | 音声ファイルの個別登録 | ローカルPCから音声ファイル（MP3, WAV, OGG形式など）を選択し、再生ボタンとしてツールに個別に追加登録できる。 | ファイル選択ダイアログを開く「＋」ボタンを配置する。自動読み込みフォルダ外のファイルを追加する場合に利用。 |
| 4.1.3 | ボタン名の設定 | 登録した音声ボタンに、ユーザーが任意の名前を付けられるようにする。 | デフォルトではファイル名を表示する。 |
| 4.1.4 | 登録の解除 | 登録済みの音声ボタンを削除できる。 | 各ボタンに「×」などの削除ボタンを配置する。 |
| 4.1.5 | 設定の永続化 | ボタン名や音量設定などをブラウザのローカルストレージに保存し、次回起動時に自動で復元する。 | ユーザーが明示的に保存操作を行う必要はない。音声ファイル自体は保存しない。 |

### 4.2. 音声再生機能

| No. | 機能名 | 機能概要 | 備考 |
| :-- | :--- | :--- | :--- |
| 4.2.1 | リモート再生機能 | リモコン（スマホ等）のボタンをタップすると、WebSocket経由でOBS側のブラウザに指示が送られ、音声が再生される。 | 遅延を極力少なくすること。 |
| 4.2.2 | 複数音声の同時再生 | 複数の音声を同時に再生（オーバーラップ）できる。 | |
| 4.2.3 | 全音声の停止 | 現在再生中のすべての音声を一括で停止させる「緊急停止」ボタンを設ける。 | この操作もWebSocket経由でOBS側に伝達される。 |
| 4.2.4 | OBS連携モード（音声再生専用） | OBSのブラウザソース内で開かれた場合、UIをすべて非表示にし、WebSocket経由の指示待機状態となり、音声再生のみを行う。 | User-Agentに "OBS" が含まれるかで自動的に判定する。 |

### 4.3. 音量調整機能

| No. | 機能名 | 機能概要 | 備考 |
| :-- | :--- | :--- | :--- |
| 4.3.1 | 個別音量調整 | 登録した音声ごとに音量を調整できるスライダーを設ける。 | 変更はWebSocket経由でOBS側にリアルタイムに反映される。 |
| 4.3.2 | マスター音量調整 | ツール全体の音量を一括で調整できるマスターボリュームを設ける。 | 変更はWebSocket経由でOBS側にリアルタイムに反映される。 |

### 4.4. UI/UX要件

| No. | 機能名 | 機能概要 | 備考 |
| :-- | :--- | :--- | :--- |
| 4.4.1 | グリッドレイアウト | 登録した音声ボタンをグリッド（格子状）に表示する。 | OBS連携モードでは非表示。 |
| 4.4.2 | レイアウト調整 | グリッドのカラム数（横に並べるボタンの数）をユーザーが設定画面で変更できるようにする。 | |
| 4.4.3 | 長押し操作 | サウンドボタンを長押しすると、個別音量調整スライダーと削除ボタンが表示される。 | タッチデバイスでの操作性を向上させる。 |

## 5. 非機能要件

| No. | 項目 | 要件 |
| :-- | :--- | :--- |
| 5.1 | パフォーマンス | ボタンクリックから音声再生までの遅延を0.2秒以下に抑える。 | WebSocket通信のオーバーヘッドを考慮。 |
| 5.2 | ユーザビリティ | 専門知識がなくても、直感的に操作方法が理解できるシンプルなUIであること。 |
| 5.3 | 互換性 | OBSに内蔵されているブラウザ（CEF、Chromiumベース）で正常に動作すること。主要なモダンブラウザ（Chrome, Firefox, Edge, Safari）でも動作確認を行う。 |
| 5.4 | **可用性** | **軽量なローカルWebサーバーを介して動作する。ユーザーは簡単なコマンドでサーバーを起動できる。** |
| 5.5 | **ネットワーク** | **同一ローカルネットワーク（LAN）内のデバイスからアクセス可能であること。** |

## 6. 技術仕様（案）

*   **フロントエンド**: HTML5, CSS3, JavaScript
*   **音声処理**: Web Audio API
*   **データ永続化**: Browser API - Local Storage
*   **サーバーサイド**: **Node.js + Express + ws (WebSocketライブラリ)**
*   **リアルタイム通信**: **WebSocketを利用し、リモコン（コントローラー）とOBS（プレイヤー）間の通信を行う。**

## 7. 画面レイアウト（案）

テキストベースのワイヤーフレーム。

```
+----------------------------------------------------------------------+
| ポン出しツール v1.0                                                  |
|                                                                      |
| [設定⚙] [全停止⏹]  マスターボリューム: [----o--]                     |
+----------------------------------------------------------------------+
|                                                                      |
| [ [拍手]               ]  [ [歓声]               ]  [ [ブブー]             ] |
| [ Vol: [---o---] ] [×] |  [ Vol: [---o---] ] [×] |  [ Vol: [---o---] ] [×] |
|                                                                      |
| [ [デデン！]             ]  [ [キラキラ]           ]  [ [＋] 音声を追加 ]    |
| [ Vol: [---o---] ] [×] |  [ Vol: [---o---] ] [×] |                      |
|                                                                      |
+----------------------------------------------------------------------+
```

## 8. 将来的な拡張案

*   キーボードショートカットによる再生機能
*   音声のループ再生機能
*   ボタンの背景色などを変更できる簡易的なカスタマイズ機能
*   複数のページ（サウンドセット）を切り替える機能

## 9. ディレクトリ・ファイル構造（案）

本ツールは以下の様なファイル構成を想定する。

```
/pondashi-tool/
|-- index.html       # アプリケーション本体のHTMLファイル
|-- style.css        # デザインを定義するCSSファイル
|-- app.js           # アプリケーションの動作を記述するJavaScriptファイル
|-- server.js        # 音声ファイル一覧APIを提供する軽量Webサーバー
|-- /sounds/         # ユーザーが音声ファイル（mp3, wav等）を配置するフォルダ
|   |-- sound1.mp3
|   |-- sound2.wav
|   +-- ...
+-- README.md        # 使い方を記した説明ファイル
```

**説明:**

*   ユーザーはダウンロードしたツールのフォルダ直下にある `sounds` フォルダの中に、使用したい音声ファイルを入れる。まずは、テスト用の音声ファイルをいくつか配置しましょう。何か適当な音声ファイルはありますか？なければ、こちらでフリー素材を探して配置します。
*   **`server.js` を実行することで、ローカルWebサーバーが起動する。**
*   OBSのブラウザソースには、**`http://localhost:PORT` のようなローカルホストアドレスを指定する。**
*   **別端末からは `http://<PCのIPアドレス>:PORT` でアクセスして操作する。**
